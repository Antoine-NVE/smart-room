@startuml SmartRoom_Containers_C4.puml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
LAYOUT_TOP_DOWN()

title SmartRoom — Diagramme C4: Conteneurs (Version simplifiée)

Person(visitor, "Visiteur", "Non connecté — consulte les salles")
Person(user, "Utilisateur", "Connecté — réserve/annule")
Person(admin, "Administrateur", "Gère salles, utilisateurs, statistiques")

System_Boundary(s1, "SmartRoom") {

  Container(web, "Application Web SmartRoom", "SPA React TypeScript", "Interface utilisateur : consultation, authentification, réservation, administration")

  Container(api, "API REST SmartRoom", "Node.js TypeScript Docker", "Endpoints REST : authentification, salles, réservations, signalements, statistiques")

  Container(auth, "Module Authentification & Session", "Node.js TypeScript", "Gestion des identités, rôles (Visiteur, Utilisateur, Admin) et sessions")

  ' --- CONTENEUR SERVICES MÉTIER ---
  Container_Boundary(services, "Container Services") {

    Container(sRes, "Service Réservation", "Node.js TypeScript", "Gestion des réservations : création, modification, annulation")

    Container(sRooms, "Service Gestion des salles", "Node.js TypeScript", "Gestion du catalogue : salles, disponibilités, fermetures/ouvertures")

    Container(sInc, "Service Signalements", "Node.js TypeScript", "Signalements : pannes, incidents, problèmes")

    Container(sStats, "Service Statistiques", "Node.js TypeScript", "Statistiques d’occupation et rapports")
  }

  Container(notif, "Service Notification", "Node.js TypeScript", "Formate et envoie les e-mails de notification")

  ContainerDb(db, "SmartRoomDB", "PostgreSQL Docker", "Salles, réservations, signalements, statistiques, utilisateurs, rôles")
}

System_Ext(mailSrv, "Serveur de mail (SMTP/Exchange)", "Relais e-mail")

' ───────────────────────────────
' Relations utilisateurs → UI
' ───────────────────────────────
Rel(visitor, web, "Consulte")
Rel(user, web, "Consulte, réserve")
Rel(admin, web, "Administre")

' ───────────────────────────────
' Front → API → Auth → Services
' ───────────────────────────────
Rel(web, api, "Appels REST JSON", "HTTPS")
Rel(api, auth, "Vérifie identité et rôle")

Rel(api, services, "Appels métier vers :\n- Réservation\n- Gestion des salles\n- Signalements\n- Statistiques")

Rel(auth, services, "Contrôle d’accès selon rôle")

' ───────────────────────────────
' Services → Base de données
' ───────────────────────────────
Rel(services, db, "Lecture / écriture données métier", "SQL")

' ───────────────────────────────
' Services → Notification → Mail
' ───────────────────────────────
Rel(services, notif, "Demande d’envoi de notifications")
Rel(mailSrv, user, "Notifications distribuées", "E-mail")
Rel(mailSrv, admin, "Notifications distribuées", "E-mail")
Rel(notif, mailSrv, "Envoie e-mails", "SMTP")


@enduml
